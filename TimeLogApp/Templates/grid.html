{% extends "layouts/main.html" %}
{% load static %}
{% load component_tags %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/form.css' %}">
<!-- Use ONLY modern theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-theme-quartz.css">
{{ component_media }}
{% endblock %}

{% block content %}
<section class="form-main-container" style="display: flex; width: 100%;">
    {% component 'sidebar' %}{% endcomponent %}
    <div class="forms-container user" style="width: 95%;">
        <div class="forms-container" style="width: 96%; margin: 0 10px; padding: 20px; height: 94vh;
            background: #FFFFFF; box-shadow: 10px 20px 30px #3F27684D;
            border: 1px solid #D4CDE1; border-radius: 30px;">
            <div class="user-title">
                <p style="font: normal normal normal 27px/34px sans-serif;">Users</p>
                <div class="actions" style="display: flex;">
                    <a href="{% url 'home' %}" class="add">
                        <h3><span>+</span>Add</h3>
                    </a>
                </div>
            </div>
            <div id="myGrid" class="ag-theme-quartz" style="height: 90%; width: 100%;"></div>
        </div> 
    </div>
</section>
{% endblock %}

{% block script %}
<!-- Only include ONCE -->
<script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const columnDefs = [
            {
                headerName: 'Actions',
                field: 'actions',
                cellRenderer: params => {
                    const userId = params.data.id;
                    return `
                        <a href="/users/update/${userId}" title="Edit" class="data-actions" style="text-decoration:none;">
                            <img src="{% static 'images/edit.svg' %}" alt="Edit" width="40px" height="40px">
                        </a>
                        <a href="/users/delete/${userId}" title="Delete" onclick="return confirm('Are you sure you want to delete this user?')" class="data-actions" style=" style="text-decoration:none;">
                            <img src="{% static 'images/delete_icon.svg' %}" alt="Delete" width="40px" height="40px">
                        </a>
                    `;
                },
                suppressSizeToFit: true,
                width: 120,
                cellStyle: {
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px'
                },
                pinned: 'left'
            },
            { field: 'userName' },
            { field: 'email' },
            { field: 'mobileNumber' },
            { field: 'team' },
            { field: 'teamLead' },
            { field: 'isActive' },
            { field: 'isActiveRemarks' },
            { field: 'isAccountLocked' },
            { field: 'isAccountLockedRemarks' },
            { field: 'createdBy' },

        ];

        const gridOptions = {
            columnDefs,
            defaultColDef: {
                sortable: true,
                filter: false,
                resizable: true,
                suppressMovable: true
            },
            rowHeight: 70,
            pagination: true,
            paginationPageSize: 10,
            onGridReady: function (params) {
                fetch('/api/users/')
                    .then(response => response.json())
                    .then(data => {
                        console.log(data); // Debug
                        params.api.applyTransaction({ add: data });
                    })
                    .catch(error => {
                        console.error('Failed to load data:', error);
                    });
            }
        };

        const gridDiv = document.getElementById('myGrid');
        agGrid.createGrid(gridDiv, gridOptions);
    });
</script>
{% endblock %}